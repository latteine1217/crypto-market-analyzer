# ============================================
# Binance BTC/USDT 1分鐘 K線 Collector 配置
# ============================================

# 基本資訊
name: binance_btcusdt_1m
description: "Binance BTC/USDT 1分鐘 K線資料收集"

# 交易所配置
exchange:
  name: binance
  api_endpoint: https://api.binance.com
  api_key: ${BINANCE_API_KEY}
  api_secret: ${BINANCE_API_SECRET}

# 交易對配置
symbol:
  base: BTC
  quote: USDT
  exchange_symbol: BTCUSDT

# 資料類型配置
data_type: ohlcv
timeframe: 1m

# 收集模式
mode:
  # 歷史資料補齊
  historical:
    enabled: true
    start_date: "2024-01-01T00:00:00Z"
    end_date: null  # null 表示到當前時間
    batch_size: 1000  # 每次請求的 K線數量

  # 定期批次更新
  periodic:
    enabled: true
    schedule: "*/5 * * * *"  # 每 5 分鐘執行一次
    lookback_minutes: 10     # 回溯 10 分鐘以補缺

  # WebSocket 實時（第二階段）
  realtime:
    enabled: false

# API 請求配置
request:
  timeout: 30
  max_retries: 3
  retry_delay: 5
  backoff_factor: 2

# 速率限制
rate_limit:
  requests_per_minute: 1200
  requests_per_second: 20
  weight_per_request: 1
  max_weight: 1200

# 資料驗證
validation:
  enabled: true
  checks:
    - timestamp_order      # 時間戳單調遞增
    - no_duplicates        # 無重複資料
    - price_range          # 價格在合理範圍
    - volume_positive      # 成交量為正

# 儲存配置
storage:
  target: timescaledb
  table: ohlcv
  conflict_strategy: upsert  # insert, upsert, skip
  batch_insert: true
  batch_size: 100

# 錯誤處理
error_handling:
  on_api_error: retry
  on_validation_error: skip_and_log
  on_storage_error: retry
  max_consecutive_failures: 10

# 監控與日誌
monitoring:
  log_every_n_batches: 10
  metrics:
    - rows_inserted
    - api_calls
    - api_errors
    - validation_failures
