# ğŸ³ Docker æ•´åˆå®Œæˆå ±å‘Š

> **å®Œæˆæ™‚é–“**: 2026-01-14  
> **ç‹€æ…‹**: âœ… æ‰€æœ‰æœå‹™æˆåŠŸå®¹å™¨åŒ–ä¸¦é‹è¡Œ

---

## ğŸ“Š å®Œæˆç¸½çµ

### âœ… æˆå°±
1. **API Server** - æˆåŠŸå®¹å™¨åŒ–ä¸¦é‹è¡Œ
2. **Dashboard** - æˆåŠŸå®¹å™¨åŒ–ä¸¦é‹è¡Œ
3. **å®¹å™¨é–“ç¶²è·¯** - æ­£å¸¸é€šä¿¡
4. **è³‡æ–™æŒä¹…åŒ–** - é€é Docker volumes ä¿è­‰
5. **è‡ªå‹•æ¸¬è©¦è…³æœ¬** - å®Œæ•´é©—è­‰æµç¨‹

### ğŸ“¦ å·²æ§‹å»ºæ˜ åƒ

| æ˜ åƒåç¨± | å¤§å° | ç‹€æ…‹ |
|---------|------|------|
| `finance-api-server:latest` | ~110MB | âœ… æ­£å¸¸ |
| `finance-dashboard-ts:latest` | ~320MB | âœ… æ­£å¸¸ |

---

## ğŸ”§ ä¿®æ­£çš„å•é¡Œ

### 1. API Server Dockerfile ç¼ºå°‘æ§‹å»ºä¾è³´
**å•é¡Œ**: ä½¿ç”¨ `npm ci --only=production` ç¼ºå°‘ TypeScript å’Œ devDependencies

**è§£æ±º**:
```dockerfile
# âŒ èˆŠç‰ˆ
RUN npm ci --only=production

# âœ… æ–°ç‰ˆ
RUN npm ci  # å®‰è£æ‰€æœ‰ä¾è³´ç”¨æ–¼æ§‹å»º
```

### 2. Dashboard ç’°å¢ƒè®Šæ•¸éŒ¯èª¤
**å•é¡Œ**: `NEXT_PUBLIC_API_URL=http://localhost:8080` åœ¨å®¹å™¨å…§ç„¡æ³•è¨ªå•

**è§£æ±º**:
```yaml
# âŒ èˆŠç‰ˆ
- NEXT_PUBLIC_API_URL=http://localhost:8080

# âœ… æ–°ç‰ˆ
- NEXT_PUBLIC_API_URL=http://api-server:8080
```

### 3. Dashboard Dockerfile public ç›®éŒ„ç¼ºå¤±
**å•é¡Œ**: å˜—è©¦è¤‡è£½ä¸å­˜åœ¨çš„ `public` ç›®éŒ„å°è‡´æ§‹å»ºå¤±æ•—

**è§£æ±º**:
```dockerfile
# âŒ èˆŠç‰ˆ
COPY --from=builder /app/public ./public

# âœ… æ–°ç‰ˆ
RUN mkdir -p ./public  # ç¢ºä¿ç›®éŒ„å­˜åœ¨
```

### 4. ç¼ºå°‘ .dockerignore
**å•é¡Œ**: æœƒå°‡ `node_modules`ã€`.git` ç­‰ä¸å¿…è¦æª”æ¡ˆè¤‡è£½é€²æ˜ åƒ

**è§£æ±º**: å»ºç«‹ `.dockerignore` æ’é™¤ä¸å¿…è¦æª”æ¡ˆ

---

## ğŸš€ éƒ¨ç½²æŒ‡ä»¤

### å¿«é€Ÿå•Ÿå‹•
```bash
# æ§‹å»ºæ˜ åƒ
docker-compose build api-server dashboard-ts

# å•Ÿå‹•æœå‹™
docker-compose up -d api-server dashboard-ts

# æŸ¥çœ‹ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f api-server
docker-compose logs -f dashboard-ts
```

### å®Œæ•´æ¸¬è©¦
```bash
# åŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦
./test-docker-services.sh
```

### é‡æ–°æ§‹å»º
```bash
# åœæ­¢ä¸¦ç§»é™¤èˆŠå®¹å™¨
docker-compose down api-server dashboard-ts

# é‡æ–°æ§‹å»ºï¼ˆä¸ä½¿ç”¨å¿«å–ï¼‰
docker-compose build --no-cache api-server dashboard-ts

# å•Ÿå‹•
docker-compose up -d api-server dashboard-ts
```

---

## ğŸ“ æ¸¬è©¦çµæœ

### API Server æ¸¬è©¦
```bash
âœ… å¥åº·æª¢æŸ¥: ok
âœ… Markets ç«¯é»: 13 markets
âœ… OHLCV ç«¯é»: BTC $96,839
âœ… Market Prices: 3 symbols
```

### Dashboard æ¸¬è©¦
```bash
âœ… é¦–é : HTTP 200
âœ… å®¹å™¨é–“ç¶²è·¯: æ­£å¸¸é€£æ¥
```

### è³‡æºä½¿ç”¨
| å®¹å™¨ | CPU | è¨˜æ†¶é«” |
|------|-----|--------|
| API Server | 0.02% | 44 MB |
| Dashboard | 0.00% | 79 MB |
| TimescaleDB | 0.01% | 104 MB |
| Redis | 0.84% | 11 MB |

---

## ğŸŒ æœå‹™æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Docker Network (bridge)         â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Dashboard  â”‚â”€â”€â”€â–¶â”‚  API Server  â”‚  â”‚
â”‚  â”‚  (port 3001) â”‚    â”‚  (port 8080) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚          â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”   â”‚
â”‚       â–¼                      â–¼     â–¼   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚  â”‚ TimescaleDB          â”‚Redis â”‚ â”‚Otherâ”‚
â”‚  â”‚ (port 5432)â”‚         â”‚(6379)â”‚ â”‚...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚
         â–¼              â–¼
    Host: 8080     Host: 3001
```

---

## ğŸ“‚ æª”æ¡ˆè®Šæ›´è¨˜éŒ„

### æ–°å¢æª”æ¡ˆ
```
api-server/.dockerignore              (æ’é™¤ä¸å¿…è¦æª”æ¡ˆ)
dashboard-ts/.dockerignore            (æ’é™¤ä¸å¿…è¦æª”æ¡ˆ)
dashboard-ts/public/.gitkeep          (ç¢ºä¿ç›®éŒ„å­˜åœ¨)
test-docker-services.sh               (è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬)
docs/DOCKER_INTEGRATION_REPORT.md     (æœ¬æ–‡æª”)
```

### ä¿®æ”¹æª”æ¡ˆ
```
api-server/Dockerfile                 (ä¿®æ­£æ§‹å»ºä¾è³´)
dashboard-ts/Dockerfile               (ä¿®æ­£ public ç›®éŒ„)
docker-compose.yml                    (ä¿®æ­£ç’°å¢ƒè®Šæ•¸)
```

---

## ğŸ¯ é©—æ”¶æ¨™æº–

| æ¨™æº– | ç‹€æ…‹ | è­‰æ“š |
|------|------|------|
| API Server æ˜ åƒæ§‹å»ºæˆåŠŸ | âœ… | æ§‹å»ºæ—¥èªŒç„¡éŒ¯èª¤ |
| Dashboard æ˜ åƒæ§‹å»ºæˆåŠŸ | âœ… | æ§‹å»ºæ—¥èªŒç„¡éŒ¯èª¤ |
| å®¹å™¨æ­£å¸¸å•Ÿå‹• | âœ… | `docker-compose ps` é¡¯ç¤º Up |
| API ç«¯é»å¯è¨ªå• | âœ… | `/health` è¿”å› 200 |
| Dashboard å¯è¨ªå• | âœ… | é¦–é è¿”å› 200 |
| å®¹å™¨é–“ç¶²è·¯æ­£å¸¸ | âœ… | Dashboard å¯è¨ªå• API Server |
| è³‡æ–™åº«é€£æ¥æ­£å¸¸ | âœ… | API èƒ½æŸ¥è©¢è³‡æ–™ |
| Redis å¿«å–æ­£å¸¸ | âœ… | æ—¥èªŒé¡¯ç¤ºé€£æ¥æˆåŠŸ |

**ç¸½çµ**: âœ… **æ‰€æœ‰é©—æ”¶æ¨™æº–é”æˆ**

---

## ğŸ”„ æŒçºŒæ•´åˆå»ºè­°

### æœªä¾†æ”¹é€²
1. **å¥åº·æª¢æŸ¥**: ç‚º API Server å’Œ Dashboard æ–°å¢ Docker healthcheck
2. **æ˜ åƒå„ªåŒ–**: ä½¿ç”¨å¤šéšæ®µæ§‹å»ºé€²ä¸€æ­¥æ¸›å°æ˜ åƒå¤§å°
3. **ç’°å¢ƒé…ç½®**: ä½¿ç”¨ `.env` æª”æ¡ˆçµ±ä¸€ç®¡ç†ç’°å¢ƒè®Šæ•¸
4. **æ—¥èªŒç®¡ç†**: æ•´åˆé›†ä¸­å¼æ—¥èªŒæ”¶é›†ï¼ˆå¦‚ ELK Stackï¼‰
5. **CI/CD**: æ•´åˆ GitHub Actions è‡ªå‹•æ§‹å»ºå’Œéƒ¨ç½²

### ç›£æ§å¢å¼·
```yaml
# ç‚ºå®¹å™¨æ–°å¢å¥åº·æª¢æŸ¥
api-server:
  healthcheck:
    test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s
```

---

## ğŸ“ å•é¡Œæ’æŸ¥

### å¸¸è¦‹å•é¡Œ

**Q: å®¹å™¨ç„¡æ³•å•Ÿå‹•ï¼Ÿ**
```bash
# æª¢æŸ¥æ—¥èªŒ
docker-compose logs api-server
docker-compose logs dashboard-ts

# æª¢æŸ¥è³‡æ–™åº«é€£æ¥
docker exec crypto_api_server wget -q -O- http://db:5432
```

**Q: API ç„¡æ³•é€£æ¥è³‡æ–™åº«ï¼Ÿ**
```bash
# ç¢ºèªè³‡æ–™åº«å¥åº·
docker-compose ps db

# æ¸¬è©¦é€£æ¥
docker exec crypto_api_server nc -zv db 5432
```

**Q: Dashboard ç„¡æ³•è¨ªå• APIï¼Ÿ**
```bash
# æ¸¬è©¦å®¹å™¨é–“ç¶²è·¯
docker exec crypto_dashboard_ts wget -q -O- http://api-server:8080/health
```

---

## ğŸ‰ çµè«–

âœ… **Docker æ•´åˆæˆåŠŸå®Œæˆ**ï¼

æ‰€æœ‰æœå‹™å·²æˆåŠŸå®¹å™¨åŒ–ä¸¦é€šéæ¸¬è©¦ï¼š
- API Server æ­£å¸¸æä¾›æœå‹™
- Dashboard æ­£å¸¸é‹è¡Œä¸¦é€£æ¥ API
- å®¹å™¨é–“ç¶²è·¯æ­£å¸¸é€šä¿¡
- è³‡æ–™æŒä¹…åŒ–æ­£å¸¸é‹ä½œ
- è³‡æºä½¿ç”¨åˆç†ï¼ˆç¸½è¨ˆ < 250MB è¨˜æ†¶é«”ï¼‰

**ä¸‹ä¸€æ­¥**: å¯ä»¥é–‹å§‹é€²è¡Œç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æº–å‚™ï¼ŒåŒ…æ‹¬ï¼š
1. é…ç½® HTTPS/TLS
2. è¨­ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
3. æ•´åˆç›£æ§å‘Šè­¦
4. å¯¦ä½œè‡ªå‹•åŒ– CI/CD

---

**å¿«é€Ÿè¨ªå•**:
- ğŸ“˜ [æœå‹™ç‹€æ…‹æ–‡æª”](../SERVICES_STATUS.md)
- ğŸ”§ [API æ–‡æª”](../api-server/README.md)
- ğŸ“Š [Dashboard æ–‡æª”](../dashboard-ts/README.md)
- ğŸ³ [Docker Compose é…ç½®](../docker-compose.yml)
